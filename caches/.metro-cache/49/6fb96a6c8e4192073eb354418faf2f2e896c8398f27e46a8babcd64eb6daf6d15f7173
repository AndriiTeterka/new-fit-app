{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"@tanstack/react-query","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":70},"end":{"line":2,"column":65,"index":135}}],"key":"Pzwu/0TIyhnZOrC9PAkpZx92hFo=","exportNames":["*"],"imports":1}},{"name":"@/lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":136},"end":{"line":3,"column":75,"index":211}}],"key":"KSAjB91cgWz7DQuLWke0G0l9TgA=","exportNames":["*"],"imports":1}},{"name":"@/storage/templates","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":212},"end":{"line":4,"column":51,"index":263}}],"key":"KEgfKdwPL+13q7v3tjvXnwuBvMg=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  var _s = $RefreshSig$();\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.useTemplates = useTemplates;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[1], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _tanstackReactQuery = require(_dependencyMap[2], \"@tanstack/react-query\");\n  var _libSupabase = require(_dependencyMap[3], \"@/lib/supabase\");\n  var _storageTemplates = require(_dependencyMap[4], \"@/storage/templates\");\n  var MIGRATION_KEY = '@supabase_migrated_templates';\n  function migrateLocalTemplatesOnce() {\n    return _migrateLocalTemplatesOnce.apply(this, arguments);\n  }\n  function _migrateLocalTemplatesOnce() {\n    _migrateLocalTemplatesOnce = (0, _asyncToGenerator.default)(function* () {\n      if (!_libSupabase.supabase) return; // no supabase configured\n      try {\n        var migrated = yield AsyncStorage.default.getItem(MIGRATION_KEY);\n        if (migrated) return;\n        // Load remote rows count\n        var _yield$supabase$from$ = yield _libSupabase.supabase.from('templates').select('*', {\n            count: 'exact',\n            head: true\n          }),\n          count = _yield$supabase$from$.count,\n          countErr = _yield$supabase$from$.error;\n        if (countErr) return; // table may not exist yet; skip silently\n        if ((count ?? 0) > 0) {\n          yield AsyncStorage.default.setItem(MIGRATION_KEY, '1');\n          return;\n        }\n        var local = yield (0, _storageTemplates.getTemplates)();\n        if (!Array.isArray(local) || local.length === 0) return;\n        // Map local templates to columns; keep JSON exercises\n        var rows = local.map(t => ({\n          id: String(t.id),\n          title: t.title,\n          duration: t.duration ?? null,\n          difficulty: t.difficulty ?? null,\n          category: t.category ?? null,\n          exercises: Array.isArray(t.exercises) ? t.exercises : [],\n          updated_at: new Date(t.updatedAt ?? Date.now()).toISOString()\n        }));\n        var _yield$supabase$from$2 = yield _libSupabase.supabase.from('templates').upsert(rows, {\n            onConflict: 'id'\n          }),\n          error = _yield$supabase$from$2.error;\n        if (!error) {\n          yield AsyncStorage.default.setItem(MIGRATION_KEY, '1');\n        }\n      } catch {}\n    });\n    return _migrateLocalTemplatesOnce.apply(this, arguments);\n  }\n  function useTemplates() {\n    _s();\n    var queryClient = (0, _tanstackReactQuery.useQueryClient)();\n    var useRemote = Boolean(_libSupabase.SUPABASE_URL && _libSupabase.SUPABASE_ANON_KEY && _libSupabase.supabase);\n    return (0, _tanstackReactQuery.useQuery)({\n      queryKey: ['templates'],\n      queryFn: function () {\n        var _ref = (0, _asyncToGenerator.default)(function* () {\n          if (!useRemote) {\n            return yield (0, _storageTemplates.getTemplates)();\n          }\n          try {\n            // Ensure one-time migration\n            yield migrateLocalTemplatesOnce();\n            var _yield$from$select$or = yield _libSupabase.supabase.from('templates').select('*').order('updated_at', {\n                ascending: false\n              }),\n              data = _yield$from$select$or.data,\n              error = _yield$from$select$or.error;\n            if (error) throw error;\n            if (Array.isArray(data) && data.length > 0) return data;\n            // Fallback to local if remote empty\n            return yield (0, _storageTemplates.getTemplates)();\n          } catch (e) {\n            // Table missing / offline ? local fallback\n            return yield (0, _storageTemplates.getTemplates)();\n          }\n        });\n        return function queryFn() {\n          return _ref.apply(this, arguments);\n        };\n      }(),\n      staleTime: 60_000\n    });\n  }\n  _s(useTemplates, \"BLZt64a2VVrVbN4W5DyNUDE4KQk=\", false, function () {\n    return [_tanstackReactQuery.useQueryClient, _tanstackReactQuery.useQuery];\n  });\n});","lineCount":104,"map":[[13,2,51,0,"exports"],[13,9,51,0],[13,10,51,0,"useTemplates"],[13,22,51,0],[13,25,51,0,"useTemplates"],[13,37,51,0],[14,2,79,1],[14,6,79,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,42,79,1],[14,45,79,1,"require"],[14,52,79,1],[14,53,79,1,"_dependencyMap"],[14,67,79,1],[15,2,79,1],[15,6,79,1,"_asyncToGenerator"],[15,23,79,1],[15,26,79,1,"_interopDefault"],[15,41,79,1],[15,42,79,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,78,79,1],[16,2,1,0],[16,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,1,0],[16,45,1,0,"require"],[16,52,1,0],[16,53,1,0,"_dependencyMap"],[16,67,1,0],[17,2,1,0],[17,6,1,0,"AsyncStorage"],[17,18,1,0],[17,21,1,0,"_interopDefault"],[17,36,1,0],[17,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,1,0],[18,2,2,0],[18,6,2,0,"_tanstackReactQuery"],[18,25,2,0],[18,28,2,0,"require"],[18,35,2,0],[18,36,2,0,"_dependencyMap"],[18,50,2,0],[19,2,3,0],[19,6,3,0,"_libSupabase"],[19,18,3,0],[19,21,3,0,"require"],[19,28,3,0],[19,29,3,0,"_dependencyMap"],[19,43,3,0],[20,2,4,0],[20,6,4,0,"_storageTemplates"],[20,23,4,0],[20,26,4,0,"require"],[20,33,4,0],[20,34,4,0,"_dependencyMap"],[20,48,4,0],[21,2,6,0],[21,6,6,6,"MIGRATION_KEY"],[21,19,6,19],[21,22,6,22],[21,52,6,52],[22,2,6,53],[22,11,18,15,"migrateLocalTemplatesOnce"],[22,36,18,40,"migrateLocalTemplatesOnce"],[22,37,18,40],[23,4,18,40],[23,11,18,40,"_migrateLocalTemplatesOnce"],[23,37,18,40],[23,38,18,40,"apply"],[23,43,18,40],[23,50,18,40,"arguments"],[23,59,18,40],[24,2,18,40],[25,2,18,40],[25,11,18,40,"_migrateLocalTemplatesOnce"],[25,38,18,40],[26,4,18,40,"_migrateLocalTemplatesOnce"],[26,30,18,40],[26,37,18,40,"_asyncToGenerator"],[26,54,18,40],[26,55,18,40,"default"],[26,62,18,40],[26,64,18,0],[26,77,18,43],[27,6,19,2],[27,10,19,6],[27,11,19,7,"supabase"],[27,23,19,15],[27,24,19,15,"supabase"],[27,32,19,15],[27,34,19,17],[27,41,19,24],[27,42,19,25],[28,6,20,2],[28,10,20,6],[29,8,21,4],[29,12,21,10,"migrated"],[29,20,21,18],[29,29,21,27,"AsyncStorage"],[29,41,21,39],[29,42,21,39,"default"],[29,49,21,39],[29,50,21,40,"getItem"],[29,57,21,47],[29,58,21,48,"MIGRATION_KEY"],[29,71,21,61],[29,72,21,62],[30,8,22,4],[30,12,22,8,"migrated"],[30,20,22,16],[30,22,22,18],[31,8,23,4],[32,8,24,4],[32,12,24,4,"_yield$supabase$from$"],[32,33,24,4],[32,42,24,45,"supabase"],[32,54,24,53],[32,55,24,53,"supabase"],[32,63,24,53],[32,64,25,7,"from"],[32,68,25,11],[32,69,25,12],[32,80,25,23],[32,81,25,24],[32,82,26,7,"select"],[32,88,26,13],[32,89,26,14],[32,92,26,17],[32,94,26,19],[33,12,26,21,"count"],[33,17,26,26],[33,19,26,28],[33,26,26,35],[34,12,26,37,"head"],[34,16,26,41],[34,18,26,43],[35,10,26,48],[35,11,26,49],[35,12,26,50],[36,10,24,12,"count"],[36,15,24,17],[36,18,24,17,"_yield$supabase$from$"],[36,39,24,17],[36,40,24,12,"count"],[36,45,24,17],[37,10,24,26,"countErr"],[37,18,24,34],[37,21,24,34,"_yield$supabase$from$"],[37,42,24,34],[37,43,24,19,"error"],[37,48,24,24],[38,8,27,4],[38,12,27,8,"countErr"],[38,20,27,16],[38,22,27,18],[38,29,27,25],[38,30,27,26],[39,8,28,4],[39,12,28,8],[39,13,28,9,"count"],[39,18,28,14],[39,22,28,18],[39,23,28,19],[39,27,28,23],[39,28,28,24],[39,30,28,26],[40,10,29,6],[40,16,29,12,"AsyncStorage"],[40,28,29,24],[40,29,29,24,"default"],[40,36,29,24],[40,37,29,25,"setItem"],[40,44,29,32],[40,45,29,33,"MIGRATION_KEY"],[40,58,29,46],[40,60,29,48],[40,63,29,51],[40,64,29,52],[41,10,30,6],[42,8,31,4],[43,8,32,4],[43,12,32,10,"local"],[43,17,32,15],[43,26,32,24],[43,30,32,24,"getTemplates"],[43,47,32,36],[43,48,32,36,"getTemplates"],[43,60,32,36],[43,62,32,37],[43,63,32,38],[44,8,33,4],[44,12,33,8],[44,13,33,9,"Array"],[44,18,33,14],[44,19,33,15,"isArray"],[44,26,33,22],[44,27,33,23,"local"],[44,32,33,28],[44,33,33,29],[44,37,33,33,"local"],[44,42,33,38],[44,43,33,39,"length"],[44,49,33,45],[44,54,33,50],[44,55,33,51],[44,57,33,53],[45,8,34,4],[46,8,35,4],[46,12,35,10,"rows"],[46,16,35,26],[46,19,35,29,"local"],[46,24,35,34],[46,25,35,35,"map"],[46,28,35,38],[46,29,35,40,"t"],[46,30,35,46],[46,35,35,52],[47,10,36,6,"id"],[47,12,36,8],[47,14,36,10,"String"],[47,20,36,16],[47,21,36,17,"t"],[47,22,36,18],[47,23,36,19,"id"],[47,25,36,21],[47,26,36,22],[48,10,37,6,"title"],[48,15,37,11],[48,17,37,13,"t"],[48,18,37,14],[48,19,37,15,"title"],[48,24,37,20],[49,10,38,6,"duration"],[49,18,38,14],[49,20,38,16,"t"],[49,21,38,17],[49,22,38,18,"duration"],[49,30,38,26],[49,34,38,30],[49,38,38,34],[50,10,39,6,"difficulty"],[50,20,39,16],[50,22,39,18,"t"],[50,23,39,19],[50,24,39,20,"difficulty"],[50,34,39,30],[50,38,39,34],[50,42,39,38],[51,10,40,6,"category"],[51,18,40,14],[51,20,40,16,"t"],[51,21,40,17],[51,22,40,18,"category"],[51,30,40,26],[51,34,40,30],[51,38,40,34],[52,10,41,6,"exercises"],[52,19,41,15],[52,21,41,17,"Array"],[52,26,41,22],[52,27,41,23,"isArray"],[52,34,41,30],[52,35,41,31,"t"],[52,36,41,32],[52,37,41,33,"exercises"],[52,46,41,42],[52,47,41,43],[52,50,41,46,"t"],[52,51,41,47],[52,52,41,48,"exercises"],[52,61,41,57],[52,64,41,60],[52,66,41,62],[53,10,42,6,"updated_at"],[53,20,42,16],[53,22,42,18],[53,26,42,22,"Date"],[53,30,42,26],[53,31,42,28,"t"],[53,32,42,29],[53,33,42,30,"updatedAt"],[53,42,42,39],[53,46,42,43,"Date"],[53,50,42,47],[53,51,42,48,"now"],[53,54,42,51],[53,55,42,52],[53,56,42,54],[53,57,42,55],[53,58,42,56,"toISOString"],[53,69,42,67],[53,70,42,68],[54,8,43,4],[54,9,43,5],[54,10,43,6],[54,11,43,7],[55,8,44,4],[55,12,44,4,"_yield$supabase$from$2"],[55,34,44,4],[55,43,44,28,"supabase"],[55,55,44,36],[55,56,44,36,"supabase"],[55,64,44,36],[55,65,44,37,"from"],[55,69,44,41],[55,70,44,42],[55,81,44,53],[55,82,44,54],[55,83,44,55,"upsert"],[55,89,44,61],[55,90,44,62,"rows"],[55,94,44,66],[55,96,44,68],[56,12,44,70,"onConflict"],[56,22,44,80],[56,24,44,82],[57,10,44,87],[57,11,44,88],[57,12,44,89],[58,10,44,12,"error"],[58,15,44,17],[58,18,44,17,"_yield$supabase$from$2"],[58,40,44,17],[58,41,44,12,"error"],[58,46,44,17],[59,8,45,4],[59,12,45,8],[59,13,45,9,"error"],[59,18,45,14],[59,20,45,16],[60,10,46,6],[60,16,46,12,"AsyncStorage"],[60,28,46,24],[60,29,46,24,"default"],[60,36,46,24],[60,37,46,25,"setItem"],[60,44,46,32],[60,45,46,33,"MIGRATION_KEY"],[60,58,46,46],[60,60,46,48],[60,63,46,51],[60,64,46,52],[61,8,47,4],[62,6,48,2],[62,7,48,3],[62,8,48,4],[62,14,48,10],[62,15,48,11],[63,4,49,0],[63,5,49,1],[64,4,49,1],[64,11,49,1,"_migrateLocalTemplatesOnce"],[64,37,49,1],[64,38,49,1,"apply"],[64,43,49,1],[64,50,49,1,"arguments"],[64,59,49,1],[65,2,49,1],[66,2,51,7],[66,11,51,16,"useTemplates"],[66,23,51,28,"useTemplates"],[66,24,51,28],[66,26,51,31],[67,4,51,31,"_s"],[67,6,51,31],[68,4,52,2],[68,8,52,8,"queryClient"],[68,19,52,19],[68,22,52,22],[68,26,52,22,"useQueryClient"],[68,45,52,36],[68,46,52,36,"useQueryClient"],[68,60,52,36],[68,62,52,37],[68,63,52,38],[69,4,53,2],[69,8,53,8,"useRemote"],[69,17,53,17],[69,20,53,20,"Boolean"],[69,27,53,27],[69,28,53,28,"SUPABASE_URL"],[69,40,53,40],[69,41,53,40,"SUPABASE_URL"],[69,53,53,40],[69,57,53,44,"SUPABASE_ANON_KEY"],[69,69,53,61],[69,70,53,61,"SUPABASE_ANON_KEY"],[69,87,53,61],[69,91,53,65,"supabase"],[69,103,53,73],[69,104,53,73,"supabase"],[69,112,53,73],[69,113,53,74],[70,4,55,2],[70,11,55,9],[70,15,55,9,"useQuery"],[70,34,55,17],[70,35,55,17,"useQuery"],[70,43,55,17],[70,45,55,30],[71,6,56,4,"queryKey"],[71,14,56,12],[71,16,56,14],[71,17,56,15],[71,28,56,26],[71,29,56,27],[72,6,57,4,"queryFn"],[72,13,57,11],[73,8,57,11],[73,12,57,11,"_ref"],[73,16,57,11],[73,23,57,11,"_asyncToGenerator"],[73,40,57,11],[73,41,57,11,"default"],[73,48,57,11],[73,50,57,13],[73,63,57,25],[74,10,58,6],[74,14,58,10],[74,15,58,11,"useRemote"],[74,24,58,20],[74,26,58,22],[75,12,59,8],[75,25,59,21],[75,29,59,21,"getTemplates"],[75,46,59,33],[75,47,59,33,"getTemplates"],[75,59,59,33],[75,61,59,34],[75,62,59,35],[76,10,60,6],[77,10,61,6],[77,14,61,10],[78,12,62,8],[79,12,63,8],[79,18,63,14,"migrateLocalTemplatesOnce"],[79,43,63,39],[79,44,63,40],[79,45,63,41],[80,12,64,8],[80,16,64,8,"_yield$from$select$or"],[80,37,64,8],[80,46,64,38,"supabase"],[80,58,64,46],[80,59,64,46,"supabase"],[80,67,64,46],[80,68,65,11,"from"],[80,72,65,15],[80,73,65,16],[80,84,65,27],[80,85,65,28],[80,86,66,11,"select"],[80,92,66,17],[80,93,66,18],[80,96,66,21],[80,97,66,22],[80,98,67,11,"order"],[80,103,67,16],[80,104,67,17],[80,116,67,29],[80,118,67,31],[81,16,67,33,"ascending"],[81,25,67,42],[81,27,67,44],[82,14,67,50],[82,15,67,51],[82,16,67,52],[83,14,64,16,"data"],[83,18,64,20],[83,21,64,20,"_yield$from$select$or"],[83,42,64,20],[83,43,64,16,"data"],[83,47,64,20],[84,14,64,22,"error"],[84,19,64,27],[84,22,64,27,"_yield$from$select$or"],[84,43,64,27],[84,44,64,22,"error"],[84,49,64,27],[85,12,68,8],[85,16,68,12,"error"],[85,21,68,17],[85,23,68,19],[85,29,68,25,"error"],[85,34,68,30],[86,12,69,8],[86,16,69,12,"Array"],[86,21,69,17],[86,22,69,18,"isArray"],[86,29,69,25],[86,30,69,26,"data"],[86,34,69,30],[86,35,69,31],[86,39,69,35,"data"],[86,43,69,39],[86,44,69,40,"length"],[86,50,69,46],[86,53,69,49],[86,54,69,50],[86,56,69,52],[86,63,69,59,"data"],[86,67,69,63],[87,12,70,8],[88,12,71,8],[88,25,71,21],[88,29,71,21,"getTemplates"],[88,46,71,33],[88,47,71,33,"getTemplates"],[88,59,71,33],[88,61,71,34],[88,62,71,35],[89,10,72,6],[89,11,72,7],[89,12,72,8],[89,19,72,15,"e"],[89,20,72,16],[89,22,72,18],[90,12,73,8],[91,12,74,8],[91,25,74,21],[91,29,74,21,"getTemplates"],[91,46,74,33],[91,47,74,33,"getTemplates"],[91,59,74,33],[91,61,74,34],[91,62,74,35],[92,10,75,6],[93,8,76,4],[93,9,76,5],[94,8,76,5],[94,24,57,4,"queryFn"],[94,31,57,11,"queryFn"],[94,32,57,11],[95,10,57,11],[95,17,57,11,"_ref"],[95,21,57,11],[95,22,57,11,"apply"],[95,27,57,11],[95,34,57,11,"arguments"],[95,43,57,11],[96,8,57,11],[97,6,57,11],[97,9,76,5],[98,6,77,4,"staleTime"],[98,15,77,13],[98,17,77,15],[99,4,78,2],[99,5,78,3],[99,6,78,4],[100,2,79,0],[101,2,79,1,"_s"],[101,4,79,1],[101,5,51,16,"useTemplates"],[101,17,51,28],[102,4,51,28],[102,12,52,22,"useQueryClient"],[102,31,52,36],[102,32,52,36,"useQueryClient"],[102,46,52,36],[102,48,55,9,"useQuery"],[102,67,55,17],[102,68,55,17,"useQuery"],[102,76,55,17],[103,2,55,17],[104,0,55,17],[104,3]],"functionMap":{"names":["<global>","migrateLocalTemplatesOnce","local.map$argument_0","useTemplates","useQuery$argument_0.queryFn"],"mappings":"AAA;ACiB;uCCiB;MDQ;CDM;OGE;aCM;KDmB;CHG"},"hasCjsExports":false},"type":"js/module"}]}